<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.3/dist/web/static/pretendard-dynamic-subset.css"
    />
    <link rel="stylesheet" th:href="@{/css/match_page/matchMain.css}" />
    <link rel="icon" href="/images/match_page/yanawalogo.png" />
    <title>매칭 메인페이지</title>
</head>
<body>
<div id="match-main">
    <header></header>
    <div></div>
    <div>
        <article></article>
        <div class="main-1">
            <div class="filter-container">
                <div class="search-area">
<!--                    <form id="teamForm" action="" >-->
                        <div class="search-div">
                            <div class="ant-form-item">
                                <div class="ant-row ant-form-item-row">
                                    <div
                                            class="ant-col ant-form-item-control"
                                    >
                                        <div
                                                class="ant-form-item-control-input"
                                        >
                                            <div
                                                    class="ant-form-item-control-input-content"
                                            >
                                                <input
                                                        placeholder="팀명 검색"
                                                        class="ant-input css-1qhpsh8 ant-input-outlined"
                                                        type="text"
                                                        id="search-keyword"
                                                        value=""
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button
                                    type="button"
                                    class="team-search"
                            ></button>
                        </div>
<!--                    </form>-->
                </div>
                <div class="mobile-overflow">
                    <form id="searchForm" action="/match/list" method="get">
                        <ul class="filters">
                            <li>
                                <div>
                                    <div class="area-div combobox-item">
                                        <div class="label-container">
                                            <select
                                                    name="sport"
                                                    class="select-input"
                                            >
                                                <option
                                                        value=""
                                                        disabled
                                                        selected
                                                        th:selected="${sport == null}"
                                                >
                                                    매칭 종목 선택
                                                </option>
                                                <option value="축구" th:selected="${sport == '축구'}">
                                                    축구
                                                </option>
                                                <option value="족구" th:selected="${sport == '족구'}">
                                                    족구
                                                </option>
                                                <option value="농구" th:selected="${sport == '농구'}">
                                                    농구
                                                </option>
                                                <option value="야구" th:selected="${sport == '야구'}">
                                                    야구
                                                </option>
                                                <option
                                                        value="배드민턴"
                                                        th:selected="${sport == '배드민턴'}"
                                                >
                                                    배드민턴
                                                </option>
                                                <!-- 추가옵션 여기에 -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <div class="area-div combobox-item">
                                        <div class="label-container">
                                            <select
                                                    name="place"
                                                    class="select-input"
                                            >
                                                <option
                                                        value=""
                                                        disabled
                                                        selected
                                                >
                                                    매칭 지역 선택
                                                </option>
                                                <option
                                                        value="서울특별시"
                                                >
                                                    서울특별시
                                                </option>
                                                <option
                                                        value="부산광역시"
                                                >
                                                    부산광역시
                                                </option>
                                                <option
                                                        value="대구광역시"
                                                >
                                                    대구광역시
                                                </option>
                                                <option
                                                        value="인천광역시"
                                                >
                                                    인천광역시
                                                </option>
                                                <option
                                                        value="광주광역시"
                                                >
                                                    광주광역시
                                                </option>
                                                <option
                                                        value="대전광역시"
                                                >
                                                    대전광역시
                                                </option>
                                                <option
                                                        value="울산광역시"
                                                >
                                                    울산광역시
                                                </option>
                                                <option
                                                        value="세종특별자치시"
                                                >
                                                    세종특별자치시
                                                </option>
                                                <option value="경기도">
                                                    경기도
                                                </option>
                                                <option
                                                        value="강원특별자치도"
                                                >
                                                    강원특별자치도
                                                </option>
                                                <option
                                                        value="충청북도"
                                                >
                                                    충청북도
                                                </option>
                                                <option
                                                        value="충청남도"
                                                >
                                                    충청남도
                                                </option>
                                                <option
                                                        value="전북특별자치도"
                                                >
                                                    전북특별자치도
                                                </option>
                                                <option
                                                        value="전라남도"
                                                >
                                                    전라남도
                                                </option>
                                                <option
                                                        value="경상북도"
                                                >
                                                    경상북도
                                                </option>
                                                <option
                                                        value="경상남도"
                                                >
                                                    경상남도
                                                </option>
                                                <option
                                                        value="제주특별자치도"
                                                >
                                                    제주특별자치도
                                                </option>
                                                <!-- 추가옵션 여기에 -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <div class="area-div combobox-item">
                                        <div
                                                class="label-container time"
                                        >
                                            <!-- 매칭시간 들어가는 곳 -->
                                            <select
                                                    name="time"
                                                    class="select-input"
                                            >
                                                <option
                                                        value=""
                                                        disabled
                                                        selected
                                                >
                                                    매칭 시간 선택
                                                </option>
                                                <option value="오전">오전</option>
                                                <option value="오후">오후</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <div
                                            class="area-div combobox-item search"
                                    >
                                        <div class="label-container">
                                            <button type="submit" class="search-all">조회하기</button>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </form>
                </div>
            </div>
        </div>
        <div class="main-2">

        </div>
        <div class="main-3">
            <span class="project-num"> 매칭대기중 </span><span th:text="${matchingCount}"></span><span class="project-num">팀 </span>
        </div>

        <div class="main-4">
            <!-- 요소추가하려면 여기서부터 복붙 -->
            <article class="article-3" th:each="match : ${matchingList}">
                <div class="match-team">
                    <div class="match-team-title">
                        <h5>
                            <a href="" th:text="'(' + ${match.city} + '/' + ${match.localCity} + '/' + ${match.teamName} + ') '
                             + ${match.postTitle}"
                            > </a
                            >
                        </h5>
                    </div>
                    <div class="category gap">
                        <span class="detail" th:text="${match.sportKindValue}"># </span>
                        <!--                        <span class="detail"># 빠른게임</span>-->
                    </div>
                    <ul class="game-time gap">
                        <li>
                                    <span class="game-time-detail"
                                    >시작시간 :</span
                                    >
                            <span class="game-time-detail"
                                  th:text="${match.choiceAmPm}"
                            ></span
                            >
                            <span class="game-time-detail"
                                  th:text="${match.timeRegister}"
                            ></span
                            >
                            <!--                            <span class="unit"> 1 경기당 </span>-->
                        </li>
                    </ul>
                    <div class="category-list">
                        <div class="project-icons gap">
                            <span class="icon email-icon">메일</span>
                            <span class="icon phone-icon">전화</span>
                            <span class="icon match-doing-icon" th:if="${match.matchingStatus == '매칭중'}">
        매칭중
    </span>


                            <span class="icon match-complete-icon" th:if="${match.matchingStatus == '매칭완료'}">
        매칭완료
    </span>
                            <!--                            <span class="icon match-new-icon"-->
                            <!--                                  th:if="${#dates.diff(match.createDate, T(java.time.LocalDateTime).now()).toHours() < 2}"-->
                            <!--                            >NEW</span>-->
                        </div>
                        <div class="game-content-detail">
                            🏃 아직 매칭 전 경기예요! 서둘러
                            매칭해 보세요 :)
                        </div>
                    </div>
                </div>
            </article>
            <div class="register">
                <div class="go-register">
                    <a href="/match/register"
                    >🏃 원하시는 매칭팀이 없나요? <br />팀을 등록
                        해보세요 :)</a
                    >
                </div>
                <div class="register-div combobox-item register">
                    <div class="label-container">
                        <div class="team-register">
                            <a href="/match/register">팀 등록하기</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="pagination">
        <ul id="pagination-wrap" style="display: block"></ul>
    </div>
    <footer></footer>
    <div></div>
</div>
</body>
<script src="/js/match_page/matchMain.js"></script>
<script th:inline="javascript">
    const pagination = [[${pagination}]]; // 서버에서 전달된 pagination 객체 사용
    const currentPage = pagination.page; // 현재 페이지
    const totalPageCount = pagination.realEnd; // 실제 마지막 페이지 수
    const paginationWrap = document.getElementById("pagination-wrap");

    // URL에서 쿼리 파라미터 값을 가져오는 함수
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // 페이지 로드 시 필터링된 값들을 쿼리 파라미터에서 가져와서 <select> 요소의 값을 설정
    document.querySelector('select[name="sport"]').value = getQueryParam('sport') || "";
    document.querySelector('select[name="place"]').value = getQueryParam('place') || "";
    document.querySelector('select[name="time"]').value = getQueryParam('time') || "";
    document.getElementById("search-keyword").value = getQueryParam('keyword') || "";

    // 필터링된 값들 가져오기 (HTML의 select 태그에서 직접 값을 가져옴)
    const sportFilter = document.querySelector('select[name="sport"]').value || "";
    const placeFilter = document.querySelector('select[name="place"]').value || "";
    const timeFilter = document.querySelector('select[name="time"]').value || "";
    const keyword = document.getElementById("search-keyword").value || "";

    // queryParams에 필터링된 값을 추가하여 빈 값이 아닌 경우에만 URL에 포함
    let queryParams = [];

    if (sportFilter) {
        queryParams.push(`sport=${sportFilter}`);
    }
    if (placeFilter) {
        queryParams.push(`place=${placeFilter}`);
    }
    if (timeFilter) {
        queryParams.push(`time=${timeFilter}`);
    }
    if (keyword) {
        queryParams.push(`keyword=${keyword}`);
    }

    // 쿼리 파라미터 문자열 생성
    let queryString = queryParams.length > 0 ? `&${queryParams.join('&')}` : "";

    let text = ``;

    // '이전' 버튼 추가 (첫 페이지에서는 비활성화)
    if (currentPage > 1) {
        text += `<li><a href="/match/list?page=${Math.max(currentPage - pagination.pageCount, 1)}${queryString}" class="prev">이전</a></li>`;
    }

    // 페이지 번호 출력 (시작 페이지부터 끝 페이지까지)
    for (let i = pagination.startPage; i <= Math.min(pagination.endPage, totalPageCount); i++) {
        if (i === pagination.currentPage) {
            text += `<li><a href="/match/list?page=${i}${queryString}" class="current" style="background-color: #ddd;">${i}</a></li>`;
        } else {
            text += `<li><a href="/match/list?page=${i}${queryString}">${i}</a></li>`;
        }
    }

    // '다음' 버튼 추가 (마지막 페이지에서는 비활성화)
    if (currentPage < totalPageCount) {
        text += `<li><a href="/match/list?page=${Math.min(pagination.startPage + pagination.pageCount, totalPageCount)}${queryString}" class="next">다음</a></li>`;
    }

    // 페이지 번호를 pagination-wrap에 추가
    paginationWrap.innerHTML = text;

    // 팀명 검색 버튼 클릭 시 동작
    document.querySelector('.team-search').addEventListener('click', function() {
        const keyword = document.getElementById("search-keyword").value || "";

        // 팀명 검색어가 있을 경우에만 처리
        if (keyword) {
            window.location.href = `/match/list?keyword=${keyword}`;
        } else {
            alert("검색어를 입력하세요."); // 검색어가 없을 경우 알림
        }
    });

    // 필터링 조회 버튼 클릭 시 동작
    document.querySelector('.search-all').addEventListener('click', function(event) {
        event.preventDefault(); // 기본 폼 제출 방지

        const sportFilter = document.querySelector('select[name="sport"]').value || "";
        const placeFilter = document.querySelector('select[name="place"]').value || "";
        const timeFilter = document.querySelector('select[name="time"]').value || "";
        const keyword = document.getElementById("search-keyword").value || "";

        // 필터링된 값들을 URL에 추가
        let queryParams = [];

        if (sportFilter) {
            queryParams.push(`sport=${sportFilter}`);
        }
        if (placeFilter) {
            queryParams.push(`place=${placeFilter}`);
        }
        if (timeFilter) {
            queryParams.push(`time=${timeFilter}`);
        }
        if (keyword) {
            queryParams.push(`keyword=${keyword}`);
        }

        // 필터링된 값들이 있을 경우에만 페이지 이동
        if (queryParams.length > 0) {
            let queryString = `?${queryParams.join('&')}`;
            window.location.href = `/match/list${queryString}`;
        } else {
            alert("필터링 조건을 선택하세요."); // 조건이 없을 경우 알림
        }
    });


    // 페이지 번호를 pagination-wrap에 추가
    paginationWrap.innerHTML = text;


</script>
</html>
